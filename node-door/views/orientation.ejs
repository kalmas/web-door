<!DOCTYPE html>
<html>
<script type="text/javascript" src="//code.jquery.com/jquery-2.1.3.min.js"></script>

<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css" />
<style type="text/css">
.garden {
  position: relative;
  width : 200px;
  height: 200px;
  border: 5px solid #CCC;
  border-radius: 10px;
}

.ball {
  position: absolute;
  top   : 90px;
  left  : 90px;
  width : 20px;
  height: 20px;
  background: green;
  border-radius: 100%;
}

.output {
  position: absolute;
  top   : 30px;
  left  : 30px;
}

</style>
</head>
<body>
<div class="garden">
  <div class="ball"></div>
</div>

<pre class="output"></pre>
<script type="text/javascript">
var ball   = document.querySelector('.ball');
var garden = document.querySelector('.garden');
var output = document.querySelector('.output');
var x = 0;
var y = 0;

var maxX = garden.clientWidth  - ball.clientWidth;
var maxY = garden.clientHeight - ball.clientHeight;

function handleOrientation(event) {
  y = Math.floor(event.beta);  // In degree in the range [-180,180]
  x = Math.floor(event.gamma); // In degree in the range [-90,90]

  if (x > 90) { x = 90; }
  if (x < - 90) { x = - 90; }
  if (y > 90) { y = 90 }
  if (y < - 90) { y = - 90 }

  output.innerHTML = 'beta : ' + x + '\n'
    + 'gamma: ' + y + "\n";

  // 10 is half the size of the ball
  // It center the positioning point to the center of the ball
  ball.style.top  = ((-1 * maxX * x / 180 - 10) + 90) + "px";
  ball.style.left = ((maxY * y / 180 - 10) + 90) + "px";

  sendCoordinates(x, y);
}

function moveKeys(e) {
  var newEvent = {};
  var newX = x;
  var newY = y;

  switch(e.which) {
    case 37: // left
      newY = newY - 5;
      break;

    case 39: // right
      newY = newY + 5;
      break;

    case 40: // down
      newX = newX - 5;
      break;

    case 38: // up
      newX = newX + 5;
      break;
  }

  newEvent.beta = newX;
  newEvent.gamma = newY;

  handleOrientation(newEvent);
}

function moveG(e) {

  if(e.beta === null || e.beta === undefined) {
    return;
  }

  handleOrientation(e);
}

function sendCoordinates(x, y) {
  $.ajax({
    data: { x: x, y: y },
    url: 'http://napple:8081/or/coord'
  });
}

window.addEventListener('deviceorientation', moveG);
window.addEventListener("keydown", moveKeys);

</script>
</html>
